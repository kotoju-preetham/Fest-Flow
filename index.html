<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        /* Existing styles... */
        
        /* Debug Console Styles */
        #debug-console {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: #00ff00;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border-radius: 8px;
            z-index: 9999;
            max-height: 100px;
            overflow-y: auto;
            border: 1px solid #333;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="loader">ðŸš€ Loading Live Events...</div>
    
    <div id="debug-console">System: Initializing Fest Flow Debugger...</div>

    <div class="admin-nav" id="authUI">
        <button id="loginBtn" class="btn-google">Admin Login</button>
    </div>

    <header class="text-white text-center py-5">
        <h1 class="display-4 fw-bold">Fest Flow</h1>
        <p class="opacity-75">Live Event Management System</p>
    </header>

    <section class="horizontal-section">
        <div class="horizontal-wrapper" id="eventContainer"></div>
    </section>

    <footer class="text-center py-4">
        <p class="opacity-75 mb-0">&copy; 2025 Fest Flow | K Preetham</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDLwOECnCBLKaM81XAPkPWNncJnb6VYLUo",
            authDomain: "festflow-10d5c.firebaseapp.com",
            projectId: "festflow-10d5c",
            storageBucket: "festflow-10d5c.appspot.com",
            messagingSenderId: "196497248283",
            appId: "1:196497248283:web:b4a10ed59b221870dca8be"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        
        const ADMIN_UID = "rTFKeYgo6sX65isgGc5mvaEY3BI3";
        const debug = document.getElementById("debug-console");

        function log(msg, isError = false) {
            const time = new Date().toLocaleTimeString();
            debug.innerHTML += `<div style="color: ${isError ? '#ff4444' : '#00ff00'}">[${time}] ${msg}</div>`;
            debug.scrollTop = debug.scrollHeight;
            console.log(msg);
        }

        // --- Auth Logic ---
        const authUI = document.getElementById("authUI");

        async function handleLogin() {
            log("Attempting Google Login...");
            try {
                const result = await signInWithPopup(auth, provider);
                log("Login Successful! User: " + result.user.email);
            } catch (error) {
                log("AUTH ERROR: " + error.code, true);
                log("MESSAGE: " + error.message, true);
                
                if (error.code === 'auth/popup-blocked') {
                    alert("Popup blocked! Please allow popups for this site in your browser settings.");
                } else if (error.code === 'auth/operation-not-allowed') {
                    alert("Google Sign-in is not enabled in Firebase Console > Authentication > Sign-in Method.");
                }
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                log("User detected: " + user.uid);
                if (user.uid === ADMIN_UID) {
                    log("Access Granted: Admin confirmed.");
                    authUI.innerHTML = `
                        <div class="d-flex align-items-center gap-3">
                            <span class="badge bg-success">Admin Mode</span>
                            <button id="logoutBtn" class="btn btn-sm btn-outline-light rounded-pill">Logout</button>
                        </div>
                    `;
                    document.getElementById("logoutBtn").onclick = () => signOut(auth);
                } else {
                    log("Access Denied: UID mismatch.", true);
                    alert("Unauthorized UID: " + user.uid);
                    signOut(auth);
                }
            } else {
                log("No user signed in.");
                authUI.innerHTML = `<button id="loginBtn" class="btn-google">Admin Login</button>`;
                document.getElementById("loginBtn").onclick = handleLogin;
            }
        });

        // --- Rest of your App Logic (initApp, renderCard, startGSAP) remains exactly as before ---
        async function initApp() {
            log("Fetching event data...");
            const container = document.getElementById("eventContainer");
            const loader = document.getElementById("loader");

            try {
                const eventsSnapshot = await getDocs(collection(db, "events"));
                log(`Found ${eventsSnapshot.docs.length} event folders.`);

                for (const eventDoc of eventsSnapshot.docs) {
                    const docRef = doc(db, "events", eventDoc.id, "details", "event");
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const raw = docSnap.data();
                        const key = Object.keys(raw)[0];
                        const ev = raw[key];
                        renderCard({
                            title: ev.title,
                            desc: ev.description,
                            category: ev.category,
                            img: ev.image || "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=800",
                            code: ev.eventCode,
                            type: ev.type
                        });
                    }
                }
                loader.style.display = "none";
                startGSAP();
                log("UI Rendering complete.");
            } catch (err) {
                log("Database Error: " + err.message, true);
                loader.innerText = "Failed to load events.";
            }
        }

        // Include your renderCard and startGSAP functions here...
        function renderCard(ev) {
            const container = document.getElementById("eventContainer");
            let finalImg = ev.img;
            if (!ev.img || ev.img.trim() === "" || (typeof ev.img === 'string' && ev.img.includes("linkedin.com/pulse"))) {
                finalImg = "https://via.placeholder.com/400x200?text=Fest+Flow";
            }

            const div = document.createElement("div");
            div.className = "event-card";
            div.innerHTML = `
                <img src="${finalImg}" class="card-img" onerror="this.src='https://via.placeholder.com/400x200?text=Fest+Flow'">
                <div class="card-body">
                    <span class="badge bg-primary mb-2">${ev.type}</span>
                    <h5 class="event-title">${ev.title}</h5>
                    <p style="font-size:0.85rem; color:#666; height: 65px; overflow: hidden;">${ev.desc}</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted"><strong>Code:</strong> ${ev.code}</small>
                        <span class="badge bg-light text-dark border">${ev.category}</span>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function startGSAP() {
            gsap.registerPlugin(ScrollTrigger);
            const wrapper = document.querySelector(".horizontal-wrapper");
            gsap.to(wrapper, {
                x: () => -(wrapper.scrollWidth - window.innerWidth + 150),
                ease: "none",
                scrollTrigger: {
                    trigger: ".horizontal-section",
                    start: "top top",
                    end: () => "+=" + wrapper.scrollWidth,
                    scrub: 1,
                    pin: true,
                    invalidateOnRefresh: true
                }
            });
            gsap.to(".event-card", { opacity: 1, y: 0, stagger: 0.1 });
        }

        initApp();
    </script>
</body>
</html>
